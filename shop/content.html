<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>内容页</title>
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <!-- layui -->
    <link href="../layui/css/layui.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="../layui/layui.js"></script>
</head>
<body>
<!--顶部-->
<div class="top clearfix">
    <div class="con top-con">
        <span class="fl">欢迎光临<em>金税通官网</em></span>
        <span class="fr"><a href="">登录</a>|<a href="">注册</a></span>
    </div>
</div>
<!--商城头部-->
<div class="mall-top">
    <div class="con clearfix">
        <img src="img/logo.png" class="logo fl">
        <div class="fr logo-right">
            <input type="text" placeholder="请输入关键词" class="search-input">
            <input type="submit" class="search-btn" value="">
            <a class="shop-cart" href="">我的购物车（0）</a>
        </div>
    </div>
    <div class="two-block con">
        <span class="all-classify">全部分类</span>
        <a href="">商城首页</a>
    </div>
</div>
<!--商城相关问题-->
<div class="con clearfix">
    <div class="con-left fl" id="menuBox"></div>
    <script id="menuData" type="text/html">
        {{#  layui.each(d.data, function(index, item){ }}
        <div class="left-link-box">
            <h4 class="con-title"><span>{{item.helpclassName}}</span></h4>
            <ul>
                {{#  layui.each(item.helpClasses, function(index, item){ }}
                <li><a href="content.html?helpclassId={{item.id}}">{{item.helpclassName}}</a></li>
                {{#  }); }}
            </ul>
        </div>
        {{#  }); }}
    </script>
    <div class="con-right fr">
        <div id="menuListBox"></div>
        <div id="menuDetailBox"></div>
    </div>
    <script type="text/html" id="menuDetailData">
        <h4 class="con-title"><span>{{d.helpTitle}}</span></h4>
        <div class="con-text">
            {{d.helpContent}}
        </div>
    </script>
    <script type="text/html" id="menuListData">
        <h4 class="con-title"><span>{{d.data.hlName}}</span></h4>
        <div class="con-text">
            <ul>
                {{#  layui.each(d.data.helpList, function(index, item){ }}
                <li><a href="content.html?helpdetailId={{item.id}}">{{item.helpTitle}}</a></li>
                {{#  }); }}
            </ul>
        </div>
    </script>
</div>
<!--footer-->
<div id="footView"></div>
<script type="text/javascript" src="js/pageJs/foot.js"></script>
<script>
    layui.use(['layer', 'laytpl'], function () {
        var layer = layui.layer;
        var laytpl = layui.laytpl;
        function getMessage() {
            $.ajax({
                url: "http://192.168.0.102/hepl/help_index.json",
                dataType: 'jsonp',
                method: '',
                data: {
                    method: 'get',
                },
                jsonp: 'callback',
                async: false,    //或false,是否异步
                timeout: 5000,    //超时时间
                success: function (data) {
                    var getTpl = menuData.innerHTML;
                    laytpl(getTpl).render(data, function (html) {
                        menuBox.innerHTML = html;
                    });
                },
                error: function () {
                    console.log('请求错误');
                }
            });
        };
        getMessage();
        //获取url上面的参数，有类似方法getQueryString
        function getPar(par) {
            //获取当前URL
            var local_url = document.location.href;
            //获取要取得的get参数位置
            var get = local_url.indexOf(par + '=');
            if (get == -1) {
                return false;
            }
            //截取字符串
            var get_par = local_url.slice(par.length + get + 1);
            //判断截取后的字符串是否还有其他get参数
            var nextPar = get_par.indexOf('&');
            if (nextPar != -1) {
                get_par = get_par.slice(0, nextPar);
            }
            return get_par;
        };
        var helpclassId = getPar("helpclassId");
        var helpdetailId = getPar("helpdetailId");
        if(helpclassId){
            getList(helpclassId);
        }else {
            getdetail(helpdetailId);
        }
        function getList(helpclassId) {
            $.ajax({
                url: "http://192.168.0.102/hepl/help_list.json",
                dataType: 'jsonp',
                method: '',
                data: {
                    method: 'get',
                    helpclassId:helpclassId,
                },
                jsonp: 'callback',
                async: false,    //或false,是否异步
                timeout: 5000,    //超时时间
                success: function (data) {
                    var getTpl = menuListData.innerHTML;
                    laytpl(getTpl).render(data, function (html) {
                        menuListBox.innerHTML = html;
                    });
                },
                error: function () {
                    console.log('请求错误');
                }
            });
        };
        function getdetail(helpdetailId) {
            $.ajax({
                url: "http://192.168.0.102/hepl/help_info.json",
                dataType: 'jsonp',
                method: '',
                data: {
                    method: 'get',
                    helpclassId:helpdetailId,
                },
                jsonp: 'callback',
                async: false,    //或false,是否异步
                timeout: 5000,    //超时时间
                success: function (data) {
                    var getTpl = menuDetailData.innerHTML;
                    laytpl(getTpl).render(data, function (html) {
                        menuDetailBox.innerHTML = html;
                    });
                },
                error: function () {
                    console.log('请求错误');
                }
            });
        };
    });
</script>
</body>
</html>