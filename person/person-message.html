<!DOCTYPE html>
<html lang="cn">
<head>
    <meta charset="UTF-8">
    <title>个人中心</title>
    <link href="/css/common.css" rel="stylesheet" type="text/css">
    <link href="/layui/css/layui.css" rel="stylesheet" type="text/css">
    <link href="/css/pc.css" rel="stylesheet" type="text/css">
    <script type="text/javascript">
    	var pIndex=2,navIndex=4;
    </script>
</head>
<body>
<!--welcome-->
<div class="welcome" id="welcomeBox"></div>
<!--个人中心顶部-->
<div class="person-top" id="personBox"></div>
<!--个人中心min-->
<div class="ke-grid clearfix person-center">
    <div class="person-center-left fl" id="personNav"></div>
    <div id="personDataInfView"></div>
</div>
<script id=personDataInf type="text/html">
<div class="my-order fr">
    <div class="my-order-title">
        <span>个人信息</span>
    </div>
    <div class="person-person clearfix layui-form">
         <div class="up-photo fl">
           <img src="{{d.data.memberHeadimg?(imgUrl+d.data.memberHeadimg):'/img/person.png'}}">
           <button>上传头像</button>
         </div>
         <div class="person-person-right fl clearfix">
             <ul>
                <li>
                   <span>纳税人识别号：</span>
                   <input class="personNumber" value="{{d.data.taxidenNumber}}" placeholder="请输入纳税人识别号">
                </li>
                <li>
                   <span>昵称：</span>
                   <input class="personNick" value="{{d.data.nickName}}" placeholder="请输入昵称">
                </li>
				<li>
                   <span>用户名：</span>
                   <input class="personName" value="{{d.data.userName}}" placeholder="请输入用户名">
                </li>
                <li>
                    <span>手机：</span>
                    <input class="personPhone" value="{{d.data.memberPhone}}" disabled="disabled">
               </li>
               <li class="choose-men personSex">
                   <span>性别：</span>
				   <label {{d.data.memberSex==1?' class="active"':''}}> <i></i> <em>男</em></label>
                   <label {{d.data.memberSex!=1?' class="active"':''}}> <i></i> <em>女</em></label>
               </li>
               <li class="birthday clearfix"">
                   <span class="fl">生日：</span>
                   <input  style="width: 365px;" class="layui-input personBirthday" value="{{d.data.memberBirth}}" placeholder="请求选择出生日期" onclick="layui.laydate({elem: this, istime: true, format: 'YYYY-MM-DD'})">
               </li>
                <li class="write-love clearfix">
                     <span class="fl">爱好：</span>
                     <textarea class="fl personLike" placeholder="请输入兴趣好爱">{{d.data.memberAutograph?d.data.memberAutograph:''}}</textarea>
               </li>
            </ul>
            <div class="message-sure">
                <a class="upMessage" href="javascript:;">保存</a>
            </div>
       </div>
   </div>
</div>
</script>
<div class="person-foot clearfix" id="foot"></div>
<script type="text/javascript" src="/js/jquery.js"></script>
<script type="text/javascript" src="/shop/js/jquerysession.js"></script>
<script type="text/javascript" src="/layui/layui.js"></script>
<script type="text/javascript" src="/js/request.js"></script>
<script type="text/javascript" src="/js/person.js"></script>
<script>
    layui.use(['laytpl', 'layer', 'laydate', 'form'], function () {
    	 var laydate = layui.laydate;
         var laytpl = layui.laytpl;
         var layer = layui.layer;
         var form = layui.form();
         var data       = request('/persion/personals_info.json',{memberId:memberId},'POST');
         var getTpl     = personDataInf.innerHTML;
         laytpl(getTpl).render(data, function (html) {
        	 personDataInfView.innerHTML = html;
         });
    });
    function message(memberVerificationInfo,type,classname) {
        $.ajax({
            url: "http://192.168.0.102/persion/member_verificationinfo.json",
            dataType: 'jsonp',
            method: '',
            data: {
                method: 'get',
                memberVerificationInfo:memberVerificationInfo,
                type:type,
            },
            jsonp: 'callback',
            async: false,    //或false,是否异步
            timeout: 5000,    //超时时间
            success: function (data) {
                if (data.code == 200){
                    $(classname).addClass("pass");
                    pass =true;
                    //layer.msg(data.msg);
                }else{
                    layer.msg(data.msg);
                }
            },
            error: function () {
                console.log('请求错误');
            }
        });
    };
    //验证用户名
    $("#personBox").on('blur','.personName',function () {
        userName = $(this).val();
        pass = false;
        message(userName,3,".personName");
    });
    //验证纳税人识别号
    $("#personBox").on('blur','.personNumber',function () {
        userName = $(this).val();
        pass = false;
        message(userName,1,".personNumber");
    });
    //提交信息
    $("#personBox").on('click','.upMessage',function () {
        var nickName = $(".personNick").val();
        var userName = $(".personName").val();
        var memberBrith = $(".personBirthday").val();
        var memberSex = $(".personSex").find('.active').index()-1;
        var memberHeadimg = 1;
        var memberAutograph = $(".personLike").val();
        var taxidenNumber = $(".personNumber").val();
        if (pass){
            $.ajax({
                url: "http://192.168.0.102/persion/modify_info.json",
                dataType: 'jsonp',
                method: '',
                data: {
                    method: 'post',
                    memberId: memberId,
                    nickName:nickName,
                    userName:userName,
                    memberBrith:memberBrith,
                    memberSex:memberSex,
                    memberHeadimg:memberHeadimg,
                    memberAutograph:memberAutograph,
                    taxidenNumber:taxidenNumber,
                },
                jsonp: 'callback',
                async: false,    //或false,是否异步
                timeout: 5000,    //超时时间
                success: function (data) {
                    location.reload();
                },
                error: function () {
                    console.log('请求错误');
                }
            });
        }else{
            layer.msg("请填写正确的信息");
        }

    })
</script>
</body>
</html>